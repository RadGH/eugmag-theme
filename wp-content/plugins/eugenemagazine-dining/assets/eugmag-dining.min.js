!function(e){e(document).ready((function(){e("#dining-guide-list-wrapper").length&&e(".rest_map").length&&function(){let t=e(".neighborhoods"),n=e(".food_types");function o(t,n,o=!0){e("#dining-guide-list-wrapper").html('<img src="/wp-content/plugins/eugenemagazine-dining/assets/loader-lg.gif" alt="" />'),window.$_GET=location.search.substr(1).split("&").reduce(((e,t)=>(u=decodeURIComponent,[k,v]=t.split("="),e[u(k)]=v&&u(v),e)),{});let a=$_GET.search?$_GET.search:"";console.log("loading page ",t),jQuery.post(eugmag_ajax_object.ajax_url,{action:"paginated_dining_guide",page:t,foodtype:n,search:a},(function(i){if(e("#dining-guide-list-wrapper").html(i),o){let e=1===t?new URL(dining_guide_url):new URL(dining_guide_url+"page/"+t);n&&e.searchParams.append("food",n),a&&e.searchParams.append("search",a),console.log("pushing history page ",window.prevpage),history.pushState({page:window.prevpage,foodtype:n},window.title,e)}}))}window.prevpage=1,e("#dining-guide-list-wrapper").on("click","a.page-numbers",(function(e){e.preventDefault();let t,n,a=jQuery(this).attr("href").match(/page\/([0-9]+)\/?(\?food=([0-9]+))?/);a?(t=parseInt(a[1]),n=a[3]?parseInt(a[3]):0):(t=1,n=0),o(t,n),window.prevpage=t})),n.change((function(){o(1,parseInt(n.val())),window.prevpage=1})),window.onpopstate=function(e){o(e.state?parseInt(e.state.page):1,e.state?parseInt(e.state.foodtype):0,!1),r(a)};let a=s(e(".rest_map"));function i(){null!=activeWindow&&activeWindow.close()}function s(n){let o=n.find(".marker"),a={zoom:11,center:new google.maps.LatLng(44.044129,-123.0946347),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},i=new google.maps.Map(n[0],a);return i.markers=[],o.each((function(){l(e(this),i)})),t.length||g(i),i}function l(e,t){let n=e.attr("data-neighborhoods")?e.attr("data-neighborhoods").toString().split(" "):"",o=e.attr("data-foodTypes")?e.attr("data-foodTypes").toString().split(" "):"",a=new google.maps.Marker({position:new google.maps.LatLng(e.attr("data-lat"),e.attr("data-lng")),map:t,title:e.attr("title"),filter:{neighborhoods:n,food_types:o}});if(t.markers.push(a),e.html()){let n=new google.maps.InfoWindow({content:e.html()});activeWindow=null,google.maps.event.addListener(a,"click",(function(){i(),n.open(t,a),activeWindow=n,t.panTo(this.getPosition())})),google.maps.event.addListener(t,"click",i)}}function g(t){let n=new google.maps.LatLngBounds,o=0;if(e.each(t.markers,(function(e,t){if(t.getVisible()){let e=new google.maps.LatLng(t.position.lat(),t.position.lng());n.extend(e),o++}})),0===o){let e=new google.maps.LatLng(44.044129,-123.0946347);t.setCenter(e),t.setZoom(12)}else 1===o?(t.setCenter(n.getCenter()),t.setZoom(14)):t.fitBounds(n)}t.length&&n.length&&(r(a),t.add(n).change((function(){r(a)})));function r(e){i();let o=parseInt(t.val()),a=parseInt(n.val());for(let t=0;t<e.markers.length;t++){let n=e.markers[t];n.setVisible(!1),(!o||n.filter.neighborhoods.indexOf(o.toString())>=0)&&(!a||n.filter.food_types.indexOf(a.toString())>=0)&&n.setVisible(!0)}g(e)}}();let t=e(".rest_gallery");t.length&&t.flickity({cellAlign:"left",contain:!0})}))}(jQuery);
