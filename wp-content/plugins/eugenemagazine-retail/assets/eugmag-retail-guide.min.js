!function(e){e(document).ready((function(){e("#retail-guide-list-wrapper").length&&e("#retail_guide_map").length&&function(){window.prevpage=1;let t=e("#retail_type"),a=l(e("#retail_guide_map"));t.length&&(p(a),t.change((function(){p(a)})));function n(e){e.preventDefault();let t=1,a=0,n=jQuery(this).attr("href").match(/page\/([0-9]+)\/?(\?retail_types=([0-9]+))?/);n&&(t=parseInt(n[1]),a=n[3]?parseInt(n[3]):0),r(t,a),window.prevpage=t}function i(){r(1,parseInt(t.val())),window.prevpage=1}function r(t,a,n=!0){e("#retail-guide-list-wrapper").html('<img src="/wp-content/plugins/eugenemagazine-retail-guide/assets/loader-lg.gif" alt="" />'),window.$_GET=location.search.substr(1).split("&").reduce(((e,t)=>(u=decodeURIComponent,[k,v]=t.split("="),e[u(k)]=v&&u(v),e)),{});let i=$_GET.search?$_GET.search:"";jQuery.post(eugmag_ajax_object.ajax_url,{action:"paginated_retail_guide",page:t,retailertype:a,search:i},(function(r){if(e("#retail-guide-list-wrapper").html(r),n){let e=1===t?new URL(retail_guide_url):new URL(retail_guide_url+"page/"+t);a&&e.searchParams.append("retail_type",a),i&&e.searchParams.append("search",i),history.pushState({page:window.prevpage,retail_type:a},window.title,e)}}))}function l(t){let a=new google.maps.Map(t[0],{zoom:11,center:new google.maps.LatLng(44.044129,-123.0946347),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1});return a.markers=[],e("#retail_map_markers").find(".marker").each((function(){o(e(this),a)})),google.maps.event.addListener(a,"click",g),s(a),a}function o(e,t){let a=e.attr("data-retailerTypes")?e.attr("data-retailerTypes").toString().split(" "):"",n=new google.maps.Marker({position:new google.maps.LatLng(e.attr("data-lat"),e.attr("data-lng")),map:t,title:e.attr("title"),filter:{retailer_types:a}});if(t.markers.push(n),e.html()){let a=new google.maps.InfoWindow({content:e.html()});google.maps.event.addListener(n,"click",(function(){g(),a.open(t,n),window.activeWindow=a,t.panTo(this.getPosition())}))}}function s(t){let a=0,n=new google.maps.LatLngBounds;if(e.each(t.markers,(function(e,t){if(console.log(t.getVisible()),t.getVisible()){let e=new google.maps.LatLng(t.position.lat(),t.position.lng());n.extend(e),a++}})),0===a){let e=new google.maps.LatLng(44.044129,-123.0946347);t.setCenter(e),t.setZoom(12)}else 1===a?(t.setCenter(n.getCenter()),t.setZoom(14)):t.fitBounds(n)}function p(e){g();let a=parseInt(t.val());for(let t=0;t<e.markers.length;t++){let n=e.markers[t],i=!a||n.filter.retailer_types.indexOf(a.toString())>=0;n.setVisible(i)}s(e)}function g(){null!=window.activeWindow&&window.activeWindow.close()}e("#retail-guide-list-wrapper").on("click","a.page-numbers",n),t.change(i),window.onpopstate=function(e){r(e.state?parseInt(e.state.page):1,e.state?parseInt(e.state.retail_type):0,!1),p(a)}}();let t=e(".retailer_gallery");t.length&&t.flickity({cellAlign:"left",contain:!0})}))}(jQuery);
